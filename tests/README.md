## Testing

Run tests with `nox` or `pytest`:

```bash
nox
```

```bash
pytest <args>
```

## Regenerating the test data

For testing there were some files generated at some point in the past. These files shouldn't be changed. However,
there are cases when they might need to be recreated. E.g. an `anndata` update could lead to warnings when loading h5ads
saved with older versions of `anndata` or similar things. In this case, the test data can be regenerated by running:

1. For test data etc.:
   Run the functions of the file `tests/_generate_test_files.py`. (not implemented yet)

2. For tests that compare their outputs to previously generated outputs (mainly plots):

-   Run the according tests
-   Find out the temp directory of pytest: e.g. from `python`:

```python
import tempfile
tempfile.gettempdir()
```

The newest outputs should be in a folder like `<tempdir>/pytest-of-<user>/pytest-<pid>/test_<testname>/`

-   Copy the new outputs to the according test subfolder `tests/...` and overwrite the old ones.

3. Some tests don't save their outputs to files but compare them directly to some reference values. In this case, there
   should be a comment in the test code that explains how to regenerate the reference values. E.g. function `test_knns_shared_comp` in `spapros/tests/evaluation/test_metrics.py`.
